name: dotnet
'on':
  push:
    paths:
    - .github/workflows/sample.yaml

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      AZURE_DEPLOY_ENVIRONMENT: dev
    steps:
    - uses: actions/checkout@v2
    - name: Login to Azure
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
    - name: get url
      run: |
        queryout=$(az webapp config hostname list --webapp-name alm-app-node-nodeappservice-dev --resource-group rg-by-workflow-shared-dev-eus2-01 --query [].name -o tsv)
        echo $queryout
        export hosturl="https://"$queryout
        echo $hosturl
        WORKING_VARIABLE=$(source .github/hosturl/endpoints; echo $dev_endpoint)
        echo $WORKING_VARIABLE
        if [ $hosturl != $WORKING_VARIABLE ]
        then
          echo $AZURE_DEPLOY_ENVIRONMENT
          echo "hosturl1=$hosturl" >> $GITHUB_ENV
          echo ${{env.hosturl1}
          echo $hosturl1
          sed -i 's/${{ env.AZURE_DEPLOY_ENVIRONMENT }}_endpoint=.*/${{ env.AZURE_DEPLOY_ENVIRONMENT }}_endpoint=${{ env.hosturl1 }}/' .github/hosturl/endpoints
          cat .github/hosturl/endpoints
        else
          echo "strings are equal"
        fi
